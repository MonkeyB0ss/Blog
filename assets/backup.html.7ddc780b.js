import{_ as a}from"./_plugin-vue_export-helper.cdc0426e.js";import{o as s,c as n,e}from"./app.8925ff20.js";const t={},r=e(`<h1 id="第19章-数据库备份与恢复" tabindex="-1"><a class="header-anchor" href="#第19章-数据库备份与恢复" aria-hidden="true">#</a> 第19章_数据库备份与恢复</h1><h2 id="_1-物理备份与逻辑备份" tabindex="-1"><a class="header-anchor" href="#_1-物理备份与逻辑备份" aria-hidden="true">#</a> <strong>1.</strong> <strong>物理备份与逻辑备份</strong></h2><p><strong>物理备份</strong>：备份数据文件，转储数据库物理文件到某一目录。物理备份恢复速度比较快，但占用空间比较大，MySQL中可以用<code>xtrabackup</code> 工具来进行物理备份。</p><p><strong>逻辑备份</strong>：对数据库对象利用工具进行导出工作，汇总入备份文件内。逻辑备份恢复速度慢，但占用空间小，更灵活。MySQL 中常用的逻辑备份工具为<code>mysqldump</code>。逻辑备份就是<code>备份sql语句</code>，在恢复的时候执行备份的sql语句实现数据库数据的重现。</p><h2 id="_2-mysqldump实现逻辑备份" tabindex="-1"><a class="header-anchor" href="#_2-mysqldump实现逻辑备份" aria-hidden="true">#</a> <strong>2. mysqldump实现逻辑备份</strong></h2><h3 id="_2-1-备份一个数据库" tabindex="-1"><a class="header-anchor" href="#_2-1-备份一个数据库" aria-hidden="true">#</a> <strong>2.1</strong> <strong>备份一个数据库</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump –u 用户名称 –h 主机名称 –p密码 待备份的数据库名称<span class="token punctuation">[</span>tbname, <span class="token punctuation">[</span>tbname<span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> 备份文件名 称.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> atguigu<span class="token operator">&gt;</span>atguigu.sql <span class="token comment">#备份文件存储在当前目录下</span>
mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> atguigudb1 <span class="token operator">&gt;</span> /var/lib/mysql/atguigu.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-备份全部数据库" tabindex="-1"><a class="header-anchor" href="#_2-2-备份全部数据库" aria-hidden="true">#</a> <strong>2.2</strong> <strong>备份全部数据库</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-pxxxxxx</span> --all-databases <span class="token operator">&gt;</span> all_database.sql 
mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-pxxxxxx</span> <span class="token parameter variable">-A</span> <span class="token operator">&gt;</span> all_database.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-备份部分数据库" tabindex="-1"><a class="header-anchor" href="#_2-3-备份部分数据库" aria-hidden="true">#</a> <strong>2.3</strong> <strong>备份部分数据库</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump –u user –h <span class="token function">host</span> –p <span class="token parameter variable">--databases</span> <span class="token punctuation">[</span>数据库的名称1 <span class="token punctuation">[</span>数据库的名称2<span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> 备份文件名 称.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">--databases</span> atguigu atguigu12 <span class="token operator">&gt;</span>two_database.sql
mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-B</span> atguigu atguigu12 <span class="token operator">&gt;</span> two_database.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-备份部分表" tabindex="-1"><a class="header-anchor" href="#_2-4-备份部分表" aria-hidden="true">#</a> <strong>2.4</strong> <strong>备份部分表</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump –u user –h <span class="token function">host</span> –p 数据库的名称 <span class="token punctuation">[</span>表名1 <span class="token punctuation">[</span>表名2<span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> 备份文件名称.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> atguigu book<span class="token operator">&gt;</span> book.sql
<span class="token comment">#备份多张表 </span>
mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> atguigu book account <span class="token operator">&gt;</span> 2_tables_bak.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-备份单表的部分数据" tabindex="-1"><a class="header-anchor" href="#_2-5-备份单表的部分数据" aria-hidden="true">#</a> <strong>2.5</strong> <strong>备份单表的部分数据</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> atguigu student <span class="token parameter variable">--where</span><span class="token operator">=</span><span class="token string">&quot;id &lt; 10 &quot;</span> <span class="token operator">&gt;</span> student_part_id10_low_bak.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-6-排除某些表的备份" tabindex="-1"><a class="header-anchor" href="#_2-6-排除某些表的备份" aria-hidden="true">#</a> <strong>2.6</strong> <strong>排除某些表的备份</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> atguigu --ignore-table<span class="token operator">=</span>atguigu.student <span class="token operator">&gt;</span> no_stu_bak.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-7-只备份结构或只备份数据" tabindex="-1"><a class="header-anchor" href="#_2-7-只备份结构或只备份数据" aria-hidden="true">#</a> <strong>2.7</strong> <strong>只备份结构或只备份数据</strong></h3><ul><li>只备份结构</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> atguigu --no-data <span class="token operator">&gt;</span> atguigu_no_data_bak.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>只备份数据</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> atguigu --no-create-info <span class="token operator">&gt;</span> atguigu_no_create_info_bak.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-8-备份中包含存储过程、函数、事件" tabindex="-1"><a class="header-anchor" href="#_2-8-备份中包含存储过程、函数、事件" aria-hidden="true">#</a> <strong>2.8</strong> <strong>备份中包含存储过程、函数、事件</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-R</span> <span class="token parameter variable">-E</span> <span class="token parameter variable">--databases</span> atguigu <span class="token operator">&gt;</span> fun_atguigu_bak.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_3-mysql命令恢复数据" tabindex="-1"><a class="header-anchor" href="#_3-mysql命令恢复数据" aria-hidden="true">#</a> <strong>3. mysql命令恢复数据</strong></h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql –u root –p <span class="token punctuation">[</span>dbname<span class="token punctuation">]</span> <span class="token operator">&lt;</span> backup.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-1-单库备份中恢复单库" tabindex="-1"><a class="header-anchor" href="#_3-1-单库备份中恢复单库" aria-hidden="true">#</a> <strong>3.1</strong> <strong>单库备份中恢复单库</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#备份文件中包含了创建数据库的语句</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token operator">&lt;</span> atguigu.sql
<span class="token comment">#备份文件中不包含了创建数据库的语句</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> atguigu<span class="token operator"><span class="token file-descriptor important">4</span>&lt;</span> atguigu.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-全量备份恢复" tabindex="-1"><a class="header-anchor" href="#_3-2-全量备份恢复" aria-hidden="true">#</a> <strong>3.2</strong> <strong>全量备份恢复</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql –u root –p <span class="token operator">&lt;</span> all.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-3-从全量备份中恢复单库" tabindex="-1"><a class="header-anchor" href="#_3-3-从全量备份中恢复单库" aria-hidden="true">#</a> <strong>3.3</strong> <strong>从全量备份中恢复单库</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sed</span> <span class="token parameter variable">-n</span> <span class="token string">&#39;/^-- Current Database: \`atguigu\`/,/^-- Current Database: \`/p&#39;</span> all_database.sql <span class="token operator">&gt;</span> atguigu.sql 
<span class="token comment">#分离完成后我们再导入atguigu.sql即可恢复单个库</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-从单库备份中恢复单表" tabindex="-1"><a class="header-anchor" href="#_3-4-从单库备份中恢复单表" aria-hidden="true">#</a> <strong>3.4</strong> <strong>从单库备份中恢复单表</strong></h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> atguigu.sql <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;/./{H;$!d;}&#39;</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;x;/CREATE TABLE \`class\`/!d;q&#39;</span> <span class="token operator">&gt;</span> class_structure.sql 
<span class="token function">cat</span> atguigu.sql <span class="token operator">|</span> <span class="token function">grep</span> --ignore-case <span class="token string">&#39;insert into \`class\`&#39;</span> <span class="token operator">&gt;</span> class_data.sql 
<span class="token comment">#用shell语法分离出创建表的语句及插入数据的语句后 再依次导出即可完成恢复 </span>

use atguigu<span class="token punctuation">;</span> 
mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">source</span> class_structure.sql<span class="token punctuation">;</span> 
Query OK, <span class="token number">0</span> rows affected, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span> 

mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">source</span> class_data.sql<span class="token punctuation">;</span> 
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-表的导出与导入" tabindex="-1"><a class="header-anchor" href="#_4-表的导出与导入" aria-hidden="true">#</a> <strong>4.</strong> <strong>表的导出与导入</strong></h2><h3 id="_4-1-表的导出" tabindex="-1"><a class="header-anchor" href="#_4-1-表的导出" aria-hidden="true">#</a> <strong>4.1</strong> <strong>表的导出</strong></h3><p><strong>1.</strong> <strong>使用SELECT…INTO OUTFILE导出文本文件</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">&#39;%secure%&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> account <span class="token keyword">INTO</span> <span class="token keyword">OUTFILE</span> <span class="token string">&quot;/var/lib/mysql-files/account.txt&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.</strong> <strong>使用mysqldump命令导出文本文件</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-T</span> <span class="token string">&quot;/var/lib/mysql-files/&quot;</span> atguigu account
<span class="token comment"># 或</span>
mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-T</span> <span class="token string">&quot;/var/lib/mysql-files/&quot;</span> atguigu account --fields-terminated- <span class="token assign-left variable">by</span><span class="token operator">=</span><span class="token string">&#39;,&#39;</span> --fields-optionally-enclosed-by<span class="token operator">=</span><span class="token string">&#39;\\&quot;&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3.</strong> <strong>使用mysql命令导出文本文件</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">--execute</span><span class="token operator">=</span><span class="token string">&quot;SELECT * FROM account;&quot;</span> atguigu<span class="token operator">&gt;</span> <span class="token string">&quot;/var/lib/mysql-files/account.txt&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-2-表的导入" tabindex="-1"><a class="header-anchor" href="#_4-2-表的导入" aria-hidden="true">#</a> <strong>4.2</strong> <strong>表的导入</strong></h3><p><strong>1.</strong> <strong>使用LOAD DATA INFILE方式导入文本文件</strong></p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">INFILE</span> <span class="token string">&#39;/var/lib/mysql-files/account_0.txt&#39;</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> atguigu<span class="token punctuation">.</span>account<span class="token punctuation">;</span>
<span class="token comment"># 或</span>
<span class="token keyword">LOAD</span> <span class="token keyword">DATA</span> <span class="token keyword">INFILE</span> <span class="token string">&#39;/var/lib/mysql-files/account_1.txt&#39;</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> atguigu<span class="token punctuation">.</span>account <span class="token keyword">FIELDS</span> <span class="token keyword">TERMINATED</span> <span class="token keyword">BY</span> <span class="token string">&#39;,&#39;</span> <span class="token keyword">ENCLOSED</span> <span class="token keyword">BY</span> <span class="token string">&#39;\\&quot;&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2.</strong> <strong>使用mysqlimport方式导入文本文件</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlimport <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> atguigu <span class="token string">&#39;/var/lib/mysql-files/account.txt&#39;</span> --fields-terminated- <span class="token assign-left variable">by</span><span class="token operator">=</span><span class="token string">&#39;,&#39;</span> --fields-optionally-enclosed-by<span class="token operator">=</span><span class="token string">&#39;\\&quot;&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,50),l=[r];function o(p,i){return s(),n("div",null,l)}const u=a(t,[["render",o],["__file","backup.html.vue"]]);export{u as default};
