const n=JSON.parse(`{"key":"v-7872cf98","path":"/note/schema/oss.html","title":"阿里云对象存储OSS最佳实践","lang":"zh-CN","frontmatter":{"date":"2023-03-05T00:00:00.000Z","category":"笔记","tag":["架构相关"]},"headers":[{"level":2,"title":"流程和源码解析","slug":"流程和源码解析","link":"#流程和源码解析","children":[]},{"level":2,"title":"Java代码示例","slug":"java代码示例","link":"#java代码示例","children":[]},{"level":2,"title":"Aliyun Spring Boot OSS 示例","slug":"aliyun-spring-boot-oss-示例","link":"#aliyun-spring-boot-oss-示例","children":[{"level":3,"title":"接入 OSS","slug":"接入-oss","link":"#接入-oss","children":[]},{"level":3,"title":"启动应用","slug":"启动应用","link":"#启动应用","children":[]},{"level":3,"title":"上传或下载文件","slug":"上传或下载文件","link":"#上传或下载文件","children":[]},{"level":3,"title":"在 OSS 上验证结果","slug":"在-oss-上验证结果","link":"#在-oss-上验证结果","children":[]}]},{"level":2,"title":"查看 Endpoint 信息","slug":"查看-endpoint-信息","link":"#查看-endpoint-信息","children":[{"level":3,"title":"以 Resource 的形式读取文件","slug":"以-resource-的形式读取文件","link":"#以-resource-的形式读取文件","children":[]}]}],"git":{"createdTime":1678017378000,"updatedTime":1705733192000,"contributors":[{"name":"MonkeyBoss","email":"1912290362@qq.com","commits":2}]},"readingTime":{"minutes":6.27,"words":1881},"filePathRelative":"note/schema/oss.md","localizedDate":"2023年3月5日","excerpt":"<h1> 阿里云对象存储OSS最佳实践</h1>\\n<p>本文主要介绍如何基于Post\\nPolicy的使用规则在服务端通过各种语言代码完成签名，然后通过表单直传数据到OSS。由于服务端签名直传无需将AccessKey暴露在前端页面，相比JavaScript客户端签名直传具有更高的安全性。</p>\\n<h2> 流程和源码解析</h2>\\n<p></p>\\n<ol>\\n<li>\\n<p>用户向应用服务器请求上传Policy和回调。 将客户端源码中的upload.js文件的以下代码片段的变量serverUrl的值设置为应用服务器的URL。</p>\\n<div class=\\"language-text line-numbers-mode\\" data-ext=\\"text\\"><pre class=\\"language-text\\"><code>// serverUrl是用户获取签名和Policy等信息的应用服务器的URL，请将下面的IP和Port配置为您自己的真实信息。\\nserverUrl = 'http://88.88.XX.XX:8888'\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div><p>设置完成后，客户端会向该serverUrl发送Get请求来获取需要的信息。</p>\\n<p>本场景为服务端签名后直传，不涉及上传回调。因此，您需要注释客户端源码中的upload.js文件内的'callback' :!q@#\\ncallbackbody字段，以关闭上传回调功能。</p>\\n<div class=\\"language-json line-numbers-mode\\" data-ext=\\"json\\"><pre class=\\"language-json\\"><code><span class=\\"token punctuation\\">{</span>\\n  <span class=\\"token property\\">\\"key\\"</span><span class=\\"token operator\\">:</span> key + <span class=\\"token string\\">\\"\${filename}\\"</span><span class=\\"token punctuation\\">,</span>\\n  <span class=\\"token property\\">\\"policy\\"</span><span class=\\"token operator\\">:</span> policyBase64<span class=\\"token punctuation\\">,</span>\\n  <span class=\\"token property\\">\\"OSSAccessKeyId\\"</span><span class=\\"token operator\\">:</span> accessid<span class=\\"token punctuation\\">,</span>\\n  <span class=\\"token comment\\">// 设置服务端返回200状态码，默认返回204。</span>\\n  <span class=\\"token property\\">\\"success_action_status\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"200\\"</span><span class=\\"token punctuation\\">,</span>\\n  <span class=\\"token property\\">\\"callback\\"</span><span class=\\"token operator\\">:</span> callbackbody<span class=\\"token punctuation\\">,</span>\\n  <span class=\\"token property\\">\\"signature\\"</span><span class=\\"token operator\\">:</span> signature\\n<span class=\\"token punctuation\\">}</span>\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div></li>\\n<li>\\n<p>应用服务器返回上传Policy和签名给用户。</p>\\n<p>应用服务器侧的签名直传服务会处理客户端发送的Get请求消息，您可以设置对应的代码让应用服务器能够给客户端返回正确的消息。</p>\\n<p>以下是签名直传服务返回给客户端消息Body内容的示例：</p>\\n<div class=\\"language-json line-numbers-mode\\" data-ext=\\"json\\"><pre class=\\"language-json\\"><code> <span class=\\"token punctuation\\">{</span>\\n <span class=\\"token property\\">\\"accessid\\"</span><span class=\\"token operator\\">:</span><span class=\\"token string\\">\\"LTAI5tBDFVar1hoq****\\"</span><span class=\\"token punctuation\\">,</span>\\n <span class=\\"token property\\">\\"host\\"</span><span class=\\"token operator\\">:</span><span class=\\"token string\\">\\"http://post-test.oss-cn-hangzhou.aliyuncs.com\\"</span><span class=\\"token punctuation\\">,</span>\\n <span class=\\"token property\\">\\"policy\\"</span><span class=\\"token operator\\">:</span><span class=\\"token string\\">\\"eyJleHBpcmF0aW9uIjoiMjAxNS0xMS0wNVQyMDoyMzoyM1oiLCJjxb25kaXRpb25zIjpbWyJjcb250ZW50LWxlbmd0aC1yYW5nZSIsMCwxMDQ4NTc2MDAwXSxbInN0YXJ0cy13aXRoIiwiJGtleSIsInVzZXItZGlyXC8i****\\"</span><span class=\\"token punctuation\\">,</span>\\n <span class=\\"token property\\">\\"signature\\"</span><span class=\\"token operator\\">:</span><span class=\\"token string\\">\\"VsxOcOudx******z93CLaXPz+4s=\\"</span><span class=\\"token punctuation\\">,</span>\\n <span class=\\"token property\\">\\"expire\\"</span><span class=\\"token operator\\">:</span><span class=\\"token number\\">1446727949</span><span class=\\"token punctuation\\">,</span>\\n <span class=\\"token property\\">\\"dir\\"</span><span class=\\"token operator\\">:</span><span class=\\"token string\\">\\"user-dirs/\\"</span>\\n <span class=\\"token punctuation\\">}</span>\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div><p><strong>Body中的各字段说明</strong></p>\\n<table>\\n<thead>\\n<tr>\\n<th>字段</th>\\n<th>描述</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td>accessid</td>\\n<td>用户请求的AccessKey ID</td>\\n</tr>\\n<tr>\\n<td>host</td>\\n<td>用户发送上传请求的域名</td>\\n</tr>\\n<tr>\\n<td>policy</td>\\n<td>用户表单上传的策略（Policy），Policy为经过Base64编码过的字符串。详情请参见<a href=\\"https://help.aliyun.com/document_detail/31988.htm?spm=a2c4g.11186623.0.0.160743b0wKePxr#section-d5z-1ww-wdb\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Post Policy</a></td>\\n</tr>\\n<tr>\\n<td>signature</td>\\n<td>对Policy签名后的字符串。详情请参见<a href=\\"https://help.aliyun.com/document_detail/31988.htm?spm=a2c4g.11186623.0.0.160743b0wKePxr#section-wny-mww-wdb\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Post Signature</a></td>\\n</tr>\\n<tr>\\n<td>expire</td>\\n<td>由服务器端指定的Policy过期时间，格式为Unix时间戳（自UTC时间1970年01月01号开始的秒数）</td>\\n</tr>\\n<tr>\\n<td>dir</td>\\n<td>限制上传的文件前缀</td>\\n</tr>\\n</tbody>\\n</table>\\n</li>\\n<li>\\n<p>用户使用Post方法向OSS发送文件上传请求</p>\\n<div class=\\"hint-container info\\">\\n<p class=\\"hint-container-title\\">说明</p>\\n<ul>\\n<li>除file表单域外，包含key在内的其他所有表单域的大小均不能超过8 KB</li>\\n<li></li>\\n</ul>\\n<p>客户端上传默认同名覆盖，如果您不希望覆盖同名文件，可以在上传请求的header中携带参数x-oss-forbid-overwrite，并指定其值为true。当您上传的文件在OSS中存在同名文件时，该文件会上传失败，并返回FileAlreadyExists错误</p>\\n</div>\\n<div class=\\"language-javascript line-numbers-mode\\" data-ext=\\"js\\"><pre class=\\"language-javascript\\"><code>new_multipart_params <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>\\n  <span class=\\"token comment\\">// key表示上传到Bucket内的Object的完整路径，例如exampledir/exampleobject.txtObject，完整路径中不能包含Bucket名称。</span>\\n  <span class=\\"token comment\\">// filename表示待上传的本地文件名称。</span>\\n  <span class=\\"token string-property property\\">'key'</span> <span class=\\"token operator\\">:</span> key <span class=\\"token operator\\">+</span> <span class=\\"token string\\">'\${filename}'</span><span class=\\"token punctuation\\">,</span>\\n  <span class=\\"token string-property property\\">'policy'</span><span class=\\"token operator\\">:</span> policyBase64<span class=\\"token punctuation\\">,</span>\\n  <span class=\\"token string-property property\\">'OSSAccessKeyId'</span><span class=\\"token operator\\">:</span> accessid<span class=\\"token punctuation\\">,</span>\\n  <span class=\\"token comment\\">// 设置服务端返回状态码为200，不设置则默认返回状态码204。</span>\\n  <span class=\\"token string-property property\\">'success_action_status'</span> <span class=\\"token operator\\">:</span> <span class=\\"token string\\">'200'</span><span class=\\"token punctuation\\">,</span>    \\n  <span class=\\"token string-property property\\">'signature'</span><span class=\\"token operator\\">:</span> signature<span class=\\"token punctuation\\">,</span>\\n <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>\\t\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div></li>\\n</ol>"}`);export{n as data};
